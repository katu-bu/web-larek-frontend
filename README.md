# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Базовый код

1. __Класс__ `EventEmitter` 
Обеспечивает работу событий. Его функции: возможность установить и снять слушателей событий, вызвать слушателей при возникновении события.
В реализации моделей и отображений нам не требуется полный набор методов данного класса, поэтому используется упрощенный интерфейс `IEventEmitter`, который позволяет вызвать слушателей при возникновении события.

2. __Интерфейс__ `IView` 
Используется для создания различных видов отображений. 
Метод `render(data: object): HTMLElement` предназначен для обновления содержимого представления с использованием данных, переданных в виде объекта. Этот метод должен возвращать обновленный элемент DOM, который будет вставлен в контейнер на странице.

## Компоненты модели данных (бизнес-логика)

1. __Класс__ `BasketModel`
Класс управляет состоянием корзины товаров, реализует интерфейс `IBasketModel`.
Он позволяет получить доступ к текущему состоянию корзины через публичное поле `items`.
Класс позволяет добавлять (`add`) и удалять (`remove`) товары из корзины.
Ключевые методы:
- `add(id: string)` — добавляет товар в корзину и отправляет событие изменения состояния (`basket:change`);
- `remove(id: string)` — удаляет товар из корзины и отправляет событие изменения состояния (`basket:change`).

2. __Класс__ `CatalogModel`
Класс управляет состоянием каталога товаров, реализует интерфейс `ICatalogModel`.
Он позволяет получить доступ к текущему набору товаров через публичное поле `items`.
Класс позволяет устанавливать список товаров (`setItems`) и получать товар по его идентификатору (`getProduct`). 
Ключевые методы:
- `setItems(items: IProduct[])` — обновляет список товаров и отправляет событие изменения состояния (`catalog:change`);
- `getProduct(id: string): IProduct` — ищет и возвращает товар по его идентификатору.

3. __Класс__ `OrderModel`
Класс хранит данные о заказе, реализует интерфейс `IOrderModel`.
Класс позволяет обновлять (`update`) данные о заказе, очищать (`clear`) информацию о заказе и получать (`getFinalOrder`) итоговые данные заказа. 
Ключевые методы:
- `update(upd: IPartialOrderData)` — обновляет введенные покупателем данные (тип оплаты: карта/наличные, электронная почта, телефон и адрес) и отправляет событие изменения состояния (`order:change`);
- `clear(total: number, items: string[])` — очищает данные заказа, устанавливает общую сумму заказа и список товаров в заказе;
- `getFinalOrder(): IOrderData` — возвращает итоговую информацию о заказе.

## Компоненты представления
1. __Класс__ `BasketView`
Выводит модальное окно корзины, отображая список товаров, добавленных в корзину (элемент `<ul>` с классом `basket__list`), и итоговую стоимость заказа (элемент `<span>` с классом `basket__price`).
По клику на кнопку оформления заказа (кнопка с классом `basket__button`) генерируется событие `ui:order-initiate`.
По клику на кнопку с классом `modal__close` модальное окно закрывается.
Методом `render(data: {items: HTMLElement [], totalPrice: number})` класс обновляет список товаров в корзине и итоговую стоимость заказа.

2. __Класс__ `BasketItemView`
Выводит один элемент товара в корзине, отображая его название (элемент `<span>` с классом `basket-item__title`) и цену (элемент `<span>` с классом `basket-item__price`).
По клику на кнопку удаления товара (кнопка с классом `basket-item__remove`) генерируется событие `ui:remove-from-basket` с идентификатором удаляемого товара.
Методом `render(data: { id: string, title: string, price: number })` класс обновляет название и цену товара.

3. __Класс__ `CatalogView`
Отображает каталог товаров на главной странице.
Методом `render(data: HTMLElement[])` класс обновляет содержимое каталога.

4. __Класс__ `CatalogItemModalView`
Выводит модальное окно с более подробным описанием конкретного товара, отображая его название (элемент `<h2>` с классом `card__title`), описание (элемент `<p>` с классом `card__text`), картинку (элемент `<img>` с классом `card__image`), категорию (элемент `<span>` с классом `card__category`) и цену (элемент `<span>` с классом `card__price`).
По клику на кнопку добавления в корзину (кнопка с классом `card__button`) генерируется событие `ui:add-to-basket` с идентификатором добавляемого товара.
По клику на кнопку с классом `modal__close` модальное окно закрывается.
Методом `render(data: { id: string, title: string, description: string, image: string, category: string, price: number})` класс обновляет содержимое модального окна, устанавливая переданные данные товара.

5. __Класс__ `IconBasketView`
Отображает кнопку (иконку) корзины и счетчик товаров в корзине (элемент `<span>` с классом `header__basket-counter`) на главной странице. 
По клику на кнопку корзины (элемент контейнера) генерируется событие `ui:basket-open`.
Методом `render(data: {quantity: number})` класс обновляет счетчик товаров в корзине.

6. __Класс__ `OrderDataFirstModalView`
Отображает модальное окно с деталями заказа: выбор способа оплаты (картой - кнопка с атрибутом `name="card"` или наличными - кнопка с атрибутом `name="cash"`) и ввод адреса доставки (элемент `<input>` с атрибутом `name="address"`).
По клику на кнопку с классом `modal__close` модальное окно закрывается.
По клику на кнопку оплаты картой или на кнопку оплаты наличными генерируется событие `ui:order-update` с параметром `{payment: "card"}` или с параметром `{payment: "cash"}` соответственно.
По клику на кнопку перехода к следующему шагу (кнопка с классом `order__button`) генерируется событие `ui:order-update` с адресом доставки и событие `ui:order-open-step2`, модальное окно закрывается.
Методом `render(_data: {})` класс обновляет содержимое модального окна.

7. __Класс__ `OrderDataSecondModalView`
Отображает модальное окно с деталями заказа: ввод номера телефона (элемент `<input>` с атрибутом `name="phone"`) и электронной почты (элемент `<input>` с атрибутом `name="email"`).
По клику на кнопку с классом `modal__close` модальное окно закрывается.
По отправке формы генерируются два события: `ui:order-update` с данными `{email, phone}` и `ui:order-made`, сигнализирующее об успешном оформлении заказа.
Методом `render(_data: {})` класс обновляет содержимое модального окна.

8. __Класс__ `OrderResultModalView`
Отображает модальное окно с подтверждением заказа, включая итоговую стоимость заказа (элемент `<p>` с классом `order-success__description`).
По клику на кнопку с классом `modal__close` или на кнопку "За новыми покупками!" (кнопка с классом `order-success__close`) модальное окно закрывается.
Методом `render(data: {totalPrice: number})` класс обновляет итоговую стоимость заказа.

## Ключевые типы данных

1. `IProduct` — тип для товара:
```
interface IProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number;
}
```

2. `IOrderData` — тип для данных заказа:
```
interface IOrderData {
  payment: string;
  email: string;
  phone: number;
  address: string;
  total: number;
  items: string[];
}
```

3. `IOrderResult` — тип для результата оформления заказа:
```
interface IOrderResult {
  id: string;
  total: number;
}
```

## Взаимодействие с API
1. __Интерфейс__ `IShopAPI`
Предназначен для взаимодействия с API магазина (веб-ларька).
Интерфейс описывает методы, которые предоставляет API для получения данных о товарах и оформления заказа.
Ключевые методы:
- `getProducts()` — получение каталога всех товаров;
- `getProductDetails(id: string)` — получение подробной информации о товаре по его идентификатору;
- `orderProducts(order: IOrderData)` - оформление заказа.